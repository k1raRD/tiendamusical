<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">


<h:head>
	<ui:include src="/pages/commons/scripts.xhtml" />
</h:head>

<h:body>
	<div class="ui-fluid">
		<h:form id="formAlbums">

			<f:event type="preRenderView"
				listener="#{adminAlbumsController.initialize}" />

			<p:growl id="messages" showSummary="true" showDetail="true"
				skipDetailIfEqualsSummary="true" />

			<ui:include src="/pages/commons/navbar.xhtml" />

			<div class="grid sample-layout">

				<div class="flex" style="width: 100%">
					<ui:include src="/pages/commons/header.xhtml" />


					<div class="col-8 flex-grow-1" style="background-color: black;">
						<div class="grid">
							<div class="col-12">

								<div class="col-2">
									<p:commandButton oncomplete="PF('dlgAlbums').show()"
										action="#{adminAlbumsController.limpiarComponentes}"
										immediate="true" update="formAddUpdateAlbum:pblAlbums"
										value="Agregar" />
								</div>


								<p:dataTable id="tblAlbums" var="album"
									value="#{adminAlbumsController.albums}" rows="20"
									emptyMessage="No se encontraron registros de albums..."
									paginator="true" rowsPerPageTemplate="20,50,100"
									paginatorPosition="bottom"
									filteredValue="#{adminAlbumsController.albumsFiltrados}"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
									currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros">

									<f:facet name="header">
										Listado de Albums
									</f:facet>

									<p:column headerText="Imagen">
										<p:graphicImage name="images/albums/#{album.imagen}"
											width="100%" />
									</p:column>

									<p:column headerText="Nombre" filterBy="#{album.nombre}"
										filterMatchMode="contains">
										<p:outputLabel value="#{album.nombre}" />
									</p:column>

									<p:column headerText="Artista"
										filterBy="#{album.artista.nombre}" filterMatchMode="contains">
										<p:outputLabel value="#{album.artista.nombre}" />
									</p:column>

									<p:column headerText="Anio">
										<p:outputLabel value="#{album.anio}" />
									</p:column>

									<p:column headerText="Formato" filterBy="#{album.formato}"
										filterMatchMode="contains">
										<p:outputLabel value="#{album.formato}" />
									</p:column>

									<p:column headerText="Precio" filterBy="#{album.valor}"
										filterMatchMode="contains">
										<p:outputLabel value="#{album.valor}">
											<f:convertNumber type="currency" />
										</p:outputLabel>
									</p:column>

									<p:column headerText="Disquera">
										<p:outputLabel value="#{album.disquera.descripcion}" />

									</p:column>
									<p:column headerText="Estatus">
										<p:outputLabel value="Habilitado" rendered="#{album.estatus}" />
										<p:outputLabel value="Deshabilitado"
											rendered="#{!album.estatus}" />
									</p:column>

									<p:column headerText="Actualizar">
										<p:commandButton icon="pi pi-pencil" immediate="true" 
											action="#{adminAlbumsController.cargarAlbum(album)}"
											oncomplete="PF('dlgAlbums').show()"
											update="formAddUpdateAlbum:pblAlbums" />
									</p:column>
								</p:dataTable>



							</div>
						</div>
					</div>
				</div>

				<ui:include src="/pages/commons/footer.xhtml" />
			</div>
		</h:form>



		<p:dialog id="dlgAlbum" header="Agregar o actualizar album"
			widgetVar="dlgAlbums" minHeight="40" responsive="true" width="50%"
			showEffect="fade" modal="true" resizable="false" height="500">

			<h:form id="formAddUpdateAlbum">

				<p:panelGrid id="pblAlbums" columns="1" layout="grid"
					styleClass="ui-panelgrid-blank" columnClasses="ui-g-12" >


					<p:outputLabel id="lblNombre" for="txtNombre" value="Nombre:" />
					<p:inputText id="txtNombre" required="true"
						requiredMessage="El nombre del album es requerido"
						value="#{adminAlbumsController.album.nombre}" />

					<p:outputLabel id="lblImagen" value="Imagen:" />
					<p:fileUpload mode="advanced" multiple="false"
						dragDropSupport="true" sizeLimit="102400"
						allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
						invalidSizeMessage="Maximum file size allowed is 100 KB"
						invalidFileMessage="only gif | jpg | jpeg | png is allowed"
						listener="#{adminAlbumsController.handleFileUpload}"
						label="Buscar" update="opTextImage" />
					<p:outputPanel id="opTextImage">
						<p:outputLabel id="lblTextImage"
							value="Se ha cargado la imagen: #{adminAlbumsController.uploadedFile.fileName}"
							rendered="#{adminAlbumsController.uploadedFile != null}" />
					</p:outputPanel>



					<p:outputLabel id="lblAnio" for="txtAnio" value="Anio:" />
					<p:inputText id="txtAnio" required="true"
						requiredMessage="El anio del album es requerido"
						value="#{adminAlbumsController.album.anio}" />

					<p:outputLabel id="lblDescripcion" for="txtDescripcion"
						value="Descripcion:" />
					<p:inputTextarea id="txtDescripcion" required="true"
						requiredMessage="La descripcion del album es requerida"
						value="#{adminAlbumsController.album.descripcion}" />

					<p:outputLabel id="lblFormato" for="txtFormato" value="Formato:" />
					<p:inputText id="txtFormato" required="true"
						requiredMessage="El formato del album es requerido"
						value="#{adminAlbumsController.album.formato}" />

					<p:outputLabel id="lblPrecio" for="txtPrecio" value="Precio:" />
					<p:inputText id="txtPrecio" required="true"
						requiredMessage="El precio del album es requerido"
						value="#{adminAlbumsController.album.valor}" />

					<p:outputLabel id="lblDisquera" for="cboDisquera" value="Disquera:" />
					<p:selectOneMenu id="cboDisquera" required="true"
						requiredMessage="La disquera es requerida"
						value="#{adminAlbumsController.album.disquera.idDisquera}">
						<f:selectItem itemValue="" itemLabel="Seleccione"></f:selectItem>
						<f:selectItems var="disquera"
							value="#{adminAlbumsController.disqueras}"
							itemValue="#{disquera.idDisquera}"
							itemLabel="#{disquera.descripcion}" />
					</p:selectOneMenu>

					<p:outputLabel id="lblArtista" for="txtPrecio" value="Artista:" />
					<p:selectOneMenu id="cboArtista" required="true"
						requiredMessage="El artista es requerido"
						value="#{adminAlbumsController.album.artista.idArtista}">
						<f:selectItem itemValue="" itemLabel="Seleccione" />
						<f:selectItems var="artista"
							value="#{adminAlbumsController.artistas}"
							itemValue="#{artista.idArtista}" itemLabel="#{artista.nombre}" />
					</p:selectOneMenu>

					<p:outputLabel id="lblEstatus" value="Estatus:"
						rendered="#{adminAlbumsController.album.idAlbum != null}" />
					<p:inputSwitch id="inputEstatus"
						value="#{adminAlbumsController.album.estatus}"
						rendered="#{adminAlbumsController.album.idAlbum != null}" />

				</p:panelGrid>


				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank" columnClasses="ui-g-6, ui-g-6">

					<p:commandButton value="Guardar" styleClass="ui-button-success"
						update="formAlbums:messages, formAddUpdateAlbum:pblAlbums, formAlbums:tblAlbums"
						action="#{adminAlbumsController.guardar}" />
					<p:commandButton value="Cancelar" styleClass="ui-button-danger"
						onclick="PF('dlgAlbums').hide()" type="button" />

				</p:panelGrid>

			</h:form>
		</p:dialog>



	</div>
</h:body>


</html>